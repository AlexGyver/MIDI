(()=>{var t={412(t,e){"use strict";function r(t,e,r){void 0===r&&(r="ticks");var n=0,i=t.length,a=i;if(i>0&&t[i-1][r]<=e)return i-1;for(;n<a;){var o=Math.floor(n+(a-n)/2),s=t[o],c=t[o+1];if(s[r]===e){for(var u=o;u<t.length;u++){t[u][r]===e&&(o=u)}return o}if(s[r]<e&&c[r]>e)return o;s[r]>e?a=o:s[r]<e&&(n=o+1)}return-1}Object.defineProperty(e,"__esModule",{value:!0}),e.insert=e.search=void 0,e.search=r,e.insert=function(t,e,n){if(void 0===n&&(n="ticks"),t.length){var i=r(t,e[n],n);t.splice(i+1,0,e)}else t.push(e)}},445(t,e){"use strict";function r(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}Object.defineProperty(e,"__esModule",{value:!0}),e.Note=void 0;var n,i,a=(n=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,i={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(t){var e=n.exec(t),r=e[1],a=e[2];return i[r.toLowerCase()]+12*(parseInt(a,10)+1)}),o=new WeakMap,s=function(){function t(t,e,r){o.set(this,r),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=e.velocity,this.ticks=t.ticks,this.durationTicks=e.ticks-t.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return t=this.midi,e=Math.floor(t/12)-1,r(t)+e.toString();var t,e},set:function(t){this.midi=a(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var e=t-this.octave;this.midi+=12*e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return r(this.midi)},set:function(t){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var t=o.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var e=o.get(this).secondsToTicks(this.time+t);this.durationTicks=e-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return o.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=o.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){return o.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();e.Note=s},498(t){function e(t,e,i){var a,o=new n,s=e.length,c=null;for(a=0;a<s;a++)!1!==i.running&&(i.running||e[a].running)||(c=null),c=r(o,e[a],c,i.useByte9ForNoteOff);t.writeChunk("MTrk",o.buffer)}function r(t,e,r,n){var i=e.type,a=e.deltaTime,o=e.text||"",s=e.data||[],c=null;switch(t.writeVarInt(a),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(o.length),t.writeString(o);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(o.length),t.writeString(o);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(o.length),t.writeString(o);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(o.length),t.writeString(o);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(o.length),t.writeString(o);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(o.length),t.writeString(o);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(o.length),t.writeString(o);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var u=31&e.hour|{24:0,25:32,29:64,30:96}[e.frameRate];t.writeUInt8(u),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var l=255&Math.floor(Math.log(e.denominator)/Math.LN2);t.writeUInt8(l),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(s.length),t.writeBytes(s);break;case"unknownMeta":null!=e.metatypeByte&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(s.length),t.writeBytes(s));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(s.length),t.writeBytes(s);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(s.length),t.writeBytes(s);break;case"noteOff":(c=(!1!==n&&e.byte9||n&&0==e.velocity?144:128)|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":(c=144|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":(c=160|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":(c=176|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":(c=192|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.programNumber);break;case"channelAftertouch":(c=208|e.channel)!==r&&t.writeUInt8(c),t.writeUInt8(e.amount);break;case"pitchBend":(c=224|e.channel)!==r&&t.writeUInt8(c);var h=8192+e.value,d=127&h,p=h>>7&127;t.writeUInt8(d),t.writeUInt8(p);break;default:throw"Unrecognized event type: "+i}return c}function n(){this.buffer=[]}n.prototype.writeUInt8=function(t){this.buffer.push(255&t)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(t){var e=t>>8&255,r=255&t;this.writeUInt8(e),this.writeUInt8(r)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(t){var e=t>>16&255,r=t>>8&255,n=255&t;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(n)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(t){var e=t>>24&255,r=t>>16&255,n=t>>8&255,i=255&t;this.writeUInt8(e),this.writeUInt8(r),this.writeUInt8(n),this.writeUInt8(i)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))},n.prototype.writeString=function(t){var e,r=t.length,n=[];for(e=0;e<r;e++)n.push(t.codePointAt(e));this.writeBytes(n)},n.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,r=[];for(r.push(127&e),e>>=7;e;){var n=127&e|128;r.push(n),e>>=7}this.writeBytes(r.reverse())}},n.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)},t.exports=function(t,r){if("object"!=typeof t)throw"Invalid MIDI data";r=r||{};var i,a=t.header||{},o=t.tracks||[],s=o.length,c=new n;for(function(t,e,r){var i=null==e.format?1:e.format,a=128;e.timeDivision?a=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?a=-(255&e.framesPerSecond)<<8|255&e.ticksPerFrame:e.ticksPerBeat&&(a=32767&e.ticksPerBeat);var o=new n;o.writeUInt16(i),o.writeUInt16(r),o.writeUInt16(a),t.writeChunk("MThd",o.buffer)}(c,a,s),i=0;i<s;i++)e(c,o[i],r);return c.buffer}},547(t,e,r){"use strict";var n=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,a=e.length;i<a;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.encode=void 0;var i=r(965),a=r(660),o=r(804);function s(t){return(0,o.flatten)(t.notes.map(function(e){return function(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(127*t.velocity)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(127*t.noteOffVelocity)}]}(e,t.channel)}))}function c(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(127*t.value)}}function u(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}e.encode=function(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:n([n(n(n(n([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map(function(t){return function(t){var e=a.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:"major"===t.scale?0:1,type:"keySignature"}}(t)}),!0),t.header.meta.map(function(t){return{absoluteTime:(e=t).ticks,deltaTime:0,meta:!0,text:e.text,type:e.type};var e}),!0),t.header.tempos.map(function(t){return function(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}(t)}),!0),t.header.timeSignatures.map(function(t){return function(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(t)}),!0)],t.tracks.map(function(t){return n(n(n([(e=t.name,{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}),u(t)],s(t),!0),function(t){for(var e=[],r=0;r<127;r++)t.controlChanges.hasOwnProperty(r)&&t.controlChanges[r].forEach(function(r){e.push(c(r,t.channel))});return e}(t),!0),function(t){var e=[];return t.pitchBends.forEach(function(r){e.push(function(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}(r,t.channel))}),e}(t),!0);var e}),!0)};return e.tracks=e.tracks.map(function(t){t=t.sort(function(t,e){return t.absoluteTime-e.absoluteTime});var e=0;return t.forEach(function(t){t.deltaTime=t.absoluteTime-e,e=t.absoluteTime,delete t.absoluteTime}),t.push({deltaTime:0,meta:!0,type:"endOfTrack"}),t}),new Uint8Array((0,i.writeMidi)(e))}},651(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createControlChanges=void 0;var n=r(796);e.createControlChanges=function(){return new Proxy({},{get:function(t,e){return t[e]?t[e]:n.controlChangeIds.hasOwnProperty(e)?t[n.controlChangeIds[e]]:void 0},set:function(t,e,r){return n.controlChangeIds.hasOwnProperty(e)?t[n.controlChangeIds[e]]=r:t[e]=r,!0}})}},659(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DrumKitByPatchID=e.InstrumentFamilyByID=e.instrumentByPatchID=void 0,e.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],e.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],e.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},660(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var n=r(412),i=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var a=function(){function t(t){var r=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",i.set(this,480),t){i.set(this,t.header.ticksPerBeat),t.tracks.forEach(function(t){t.forEach(function(t){t.meta&&("timeSignature"===t.type?r.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?r.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type&&r.keySignatures.push({key:e.keySignatureKeys[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}))})});var n=0;t.tracks[0].forEach(function(t){n+=t.deltaTime,t.meta&&("trackName"===t.type?r.name=t.text:"text"!==t.type&&"cuePoint"!==t.type&&"marker"!==t.type&&"lyrics"!==t.type||r.meta.push({text:t.text,ticks:n,type:t.type}))}),this.update()}}return t.prototype.update=function(){var t=this,e=0,r=0;this.tempos.sort(function(t,e){return t.ticks-e.ticks}),this.tempos.forEach(function(n,i){var a=i>0?t.tempos[i-1].bpm:t.tempos[0].bpm,o=n.ticks/t.ppq-r,s=60/a*o;n.time=s+e,e=n.time,r+=o}),this.timeSignatures.sort(function(t,e){return t.ticks-e.ticks}),this.timeSignatures.forEach(function(e,r){var n=r>0?t.timeSignatures[r-1]:t.timeSignatures[0],i=(e.ticks-n.ticks)/t.ppq/n.timeSignature[0]/(n.timeSignature[1]/4);n.measures=n.measures||0,e.measures=i+n.measures})},t.prototype.ticksToSeconds=function(t){var e=(0,n.search)(this.tempos,t);if(-1!==e){var r=this.tempos[e],i=r.time,a=(t-r.ticks)/this.ppq;return i+60/r.bpm*a}return.5*(t/this.ppq)},t.prototype.ticksToMeasures=function(t){var e=(0,n.search)(this.timeSignatures,t);if(-1!==e){var r=this.timeSignatures[e],i=(t-r.ticks)/this.ppq;return r.measures+i/(r.timeSignature[0]/r.timeSignature[1])/4}return t/this.ppq/4},Object.defineProperty(t.prototype,"ppq",{get:function(){return i.get(this)},enumerable:!1,configurable:!0}),t.prototype.secondsToTicks=function(t){var e=(0,n.search)(this.tempos,t,"time");if(-1!==e){var r=this.tempos[e],i=(t-r.time)/(60/r.bpm);return Math.round(r.ticks+i*this.ppq)}var a=t/.5;return Math.round(a*this.ppq)},t.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(t){return{bpm:t.bpm,ticks:t.ticks}}),timeSignatures:this.timeSignatures}},t.prototype.fromJSON=function(t){this.name=t.name,this.tempos=t.tempos.map(function(t){return Object.assign({},t)}),this.timeSignatures=t.timeSignatures.map(function(t){return Object.assign({},t)}),this.keySignatures=t.keySignatures.map(function(t){return Object.assign({},t)}),this.meta=t.meta.map(function(t){return Object.assign({},t)}),i.set(this,t.ppq),this.update()},t.prototype.setTempo=function(t){this.tempos=[{bpm:t,ticks:0}],this.update()},t}();e.Header=a},710(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Track=void 0;var n=r(412),i=r(796),a=r(651),o=r(996),s=r(980),c=r(445),u=new WeakMap,l=function(){function t(t,e){var r=this;if(this.name="",this.notes=[],this.controlChanges=(0,a.createControlChanges)(),this.pitchBends=[],u.set(this,e),t){var n=t.find(function(t){return"trackName"===t.type});this.name=n?n.text:""}if(this.instrument=new s.Instrument(t,this),this.channel=0,t){for(var i=t.filter(function(t){return"noteOn"===t.type}),o=t.filter(function(t){return"noteOff"===t.type}),c=function(){var t=i.shift();l.channel=t.channel;var e=o.findIndex(function(e){return e.noteNumber===t.noteNumber&&e.absoluteTime>=t.absoluteTime});if(-1!==e){var r=o.splice(e,1)[0];l.addNote({durationTicks:r.absoluteTime-t.absoluteTime,midi:t.noteNumber,noteOffVelocity:r.velocity/127,ticks:t.absoluteTime,velocity:t.velocity/127})}},l=this;i.length;)c();t.filter(function(t){return"controller"===t.type}).forEach(function(t){r.addCC({number:t.controllerType,ticks:t.absoluteTime,value:t.value/127})}),t.filter(function(t){return"pitchBend"===t.type}).forEach(function(t){r.addPitchBend({ticks:t.absoluteTime,value:t.value/Math.pow(2,13)})});var h=t.find(function(t){return"endOfTrack"===t.type});this.endOfTrackTicks=void 0!==h?h.absoluteTime:void 0}}return t.prototype.addNote=function(t){var e=u.get(this),r=new c.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},e);return Object.assign(r,t),(0,n.insert)(this.notes,r,"ticks"),this},t.prototype.addCC=function(t){var e=u.get(this),r=new i.ControlChange({controllerType:t.number},e);return delete t.number,Object.assign(r,t),Array.isArray(this.controlChanges[r.number])||(this.controlChanges[r.number]=[]),(0,n.insert)(this.controlChanges[r.number],r,"ticks"),this},t.prototype.addPitchBend=function(t){var e=u.get(this),r=new o.PitchBend({},e);return Object.assign(r,t),(0,n.insert)(this.pitchBends,r,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,e=0;e<this.notes.length-1;e++){var r=this.notes[e].time+this.notes[e].duration;t<r&&(t=r)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,e=0;e<this.notes.length-1;e++){var r=this.notes[e].ticks+this.notes[e].durationTicks;t<r&&(t=r)}return t},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(t){var e=this;for(var r in this.name=t.name,this.channel=t.channel,this.instrument=new s.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),void 0!==t.endOfTrackTicks&&(this.endOfTrackTicks=t.endOfTrackTicks),t.controlChanges)t.controlChanges[r]&&t.controlChanges[r].forEach(function(t){e.addCC({number:t.number,ticks:t.ticks,value:t.value})});t.notes.forEach(function(t){e.addNote({durationTicks:t.durationTicks,midi:t.midi,ticks:t.ticks,velocity:t.velocity})})},t.prototype.toJSON=function(){for(var t={},e=0;e<127;e++)this.controlChanges.hasOwnProperty(e)&&(t[e]=this.controlChanges[e].map(function(t){return t.toJSON()}));var r={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map(function(t){return t.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(t){return t.toJSON()})};return void 0!==this.endOfTrackTicks&&(r.endOfTrackTicks=this.endOfTrackTicks),r},t}();e.Track=l},748(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,a){function o(t){try{c(n.next(t))}catch(t){a(t)}}function s(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,s)}c((n=n.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var a=r(965),o=r(660),s=r(710),c=r(547),u=function(){function t(t){var e=this,r=null;if(t){var n=t instanceof ArrayBuffer?new Uint8Array(t):t;(r=(0,a.parseMidi)(n)).tracks.forEach(function(t){var e=0;t.forEach(function(t){e+=t.deltaTime,t.absoluteTime=e})}),r.tracks=function(t){for(var e=[],r=0;r<t.length;r++)for(var n=e.length,i=new Map,a=Array(16).fill(0),o=0,s=t[r];o<s.length;o++){var c=s[o],u=n,l=c.channel;if(void 0!==l){"programChange"===c.type&&(a[l]=c.programNumber);var h=a[l],d="".concat(h," ").concat(l);i.has(d)?u=i.get(d):(u=n+i.size,i.set(d,u))}e[u]||e.push([]),e[u].push(c)}return e}(r.tracks)}this.header=new o.Header(r),this.tracks=[],t&&(this.tracks=r.tracks.map(function(t){return new s.Track(t,e.header)}),1===r.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return t.fromUrl=function(e){return n(this,void 0,void 0,function(){var r;return i(this,function(n){switch(n.label){case 0:return[4,fetch(e)];case 1:return(r=n.sent()).ok?[4,r.arrayBuffer()]:[3,3];case 2:return[2,new t(n.sent())];case 3:throw new Error("Could not load '".concat(e,"'"))}})})},Object.defineProperty(t.prototype,"name",{get:function(){return this.header.name},set:function(t){this.header.name=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var t=this.tracks.map(function(t){return t.duration});return Math.max.apply(Math,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){var t=this.tracks.map(function(t){return t.durationTicks});return Math.max.apply(Math,t)},enumerable:!1,configurable:!0}),t.prototype.addTrack=function(){var t=new s.Track(void 0,this.header);return this.tracks.push(t),t},t.prototype.toArray=function(){return(0,c.encode)(this)},t.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(t){return t.toJSON()})}},t.prototype.fromJSON=function(t){var e=this;this.header=new o.Header,this.header.fromJSON(t.header),this.tracks=t.tracks.map(function(t){var r=new s.Track(void 0,e.header);return r.fromJSON(t),r})},t.prototype.clone=function(){var e=new t;return e.fromJSON(this.toJSON()),e},t}();e.Midi=u;var l=r(710);Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var h=r(660);Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return h.Header}})},786(t){function e(t){for(var e,n=new r(t),i=[];!n.eof();){var a=o();i.push(a)}return i;function o(){var t={};t.deltaTime=n.readVarInt();var r=n.readUInt8();if(240&~r){var i;if(128&r)i=n.readUInt8(),e=r;else{if(null===e)throw"Running status byte encountered before status byte";i=r,r=e,t.running=!0}var a=r>>4;switch(t.channel=15&r,a){case 8:return t.type="noteOff",t.noteNumber=i,t.velocity=n.readUInt8(),t;case 9:var o=n.readUInt8();return t.type=0===o?"noteOff":"noteOn",t.noteNumber=i,t.velocity=o,0===o&&(t.byte9=!0),t;case 10:return t.type="noteAftertouch",t.noteNumber=i,t.amount=n.readUInt8(),t;case 11:return t.type="controller",t.controllerType=i,t.value=n.readUInt8(),t;case 12:return t.type="programChange",t.programNumber=i,t;case 13:return t.type="channelAftertouch",t.amount=i,t;case 14:return t.type="pitchBend",t.value=i+(n.readUInt8()<<7)-8192,t;default:throw"Unrecognised MIDI event type: "+a}}else{if(255!==r){if(240==r){t.type="sysEx";c=n.readVarInt();return t.data=n.readBytes(c),t}if(247==r){t.type="endSysEx";c=n.readVarInt();return t.data=n.readBytes(c),t}throw"Unrecognised MIDI event type byte: "+r}t.meta=!0;var s=n.readUInt8(),c=n.readVarInt();switch(s){case 0:if(t.type="sequenceNumber",2!==c)throw"Expected length for sequenceNumber event is 2, got "+c;return t.number=n.readUInt16(),t;case 1:return t.type="text",t.text=n.readString(c),t;case 2:return t.type="copyrightNotice",t.text=n.readString(c),t;case 3:return t.type="trackName",t.text=n.readString(c),t;case 4:return t.type="instrumentName",t.text=n.readString(c),t;case 5:return t.type="lyrics",t.text=n.readString(c),t;case 6:return t.type="marker",t.text=n.readString(c),t;case 7:return t.type="cuePoint",t.text=n.readString(c),t;case 32:if(t.type="channelPrefix",1!=c)throw"Expected length for channelPrefix event is 1, got "+c;return t.channel=n.readUInt8(),t;case 33:if(t.type="portPrefix",1!=c)throw"Expected length for portPrefix event is 1, got "+c;return t.port=n.readUInt8(),t;case 47:if(t.type="endOfTrack",0!=c)throw"Expected length for endOfTrack event is 0, got "+c;return t;case 81:if(t.type="setTempo",3!=c)throw"Expected length for setTempo event is 3, got "+c;return t.microsecondsPerBeat=n.readUInt24(),t;case 84:if(t.type="smpteOffset",5!=c)throw"Expected length for smpteOffset event is 5, got "+c;var u=n.readUInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&u],t.hour=31&u,t.min=n.readUInt8(),t.sec=n.readUInt8(),t.frame=n.readUInt8(),t.subFrame=n.readUInt8(),t;case 88:if(t.type="timeSignature",2!=c&&4!=c)throw"Expected length for timeSignature event is 4 or 2, got "+c;return t.numerator=n.readUInt8(),t.denominator=1<<n.readUInt8(),4===c?(t.metronome=n.readUInt8(),t.thirtyseconds=n.readUInt8()):(t.metronome=36,t.thirtyseconds=8),t;case 89:if(t.type="keySignature",2!=c)throw"Expected length for keySignature event is 2, got "+c;return t.key=n.readInt8(),t.scale=n.readUInt8(),t;case 127:return t.type="sequencerSpecific",t.data=n.readBytes(c),t;default:return t.type="unknownMeta",t.data=n.readBytes(c),t.metatypeByte=s,t}}}}function r(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}r.prototype.eof=function(){return this.pos>=this.bufferLen},r.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t},r.prototype.readInt8=function(){var t=this.readUInt8();return 128&t?t-256:t},r.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},r.prototype.readInt16=function(){var t=this.readUInt16();return 32768&t?t-65536:t},r.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},r.prototype.readInt24=function(){var t=this.readUInt24();return 8388608&t?t-16777216:t},r.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},r.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e},r.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)},r.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(!(128&e))return t+e;t+=127&e,t<<=7}return t},r.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32();return{id:t,length:e,data:this.readBytes(e)}},t.exports=function(t){var n=new r(t),i=n.readChunk();if("MThd"!=i.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+i.id+"'";for(var a=function(t){var e=new r(t),n=e.readUInt16(),i=e.readUInt16(),a={format:n,numTracks:i},o=e.readUInt16();32768&o?(a.framesPerSecond=256-(o>>8),a.ticksPerFrame=255&o):a.ticksPerBeat=o;return a}(i.data),o=[],s=0;!n.eof()&&s<a.numTracks;s++){var c=n.readChunk();if("MTrk"!=c.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+c.id+"'";var u=e(c.data);o.push(u)}return{header:a,tracks:o}}},796(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce(function(t,r){return t[e.controlChangeNames[r]]=r,t},{});var r=new WeakMap,n=new WeakMap,i=function(){function t(t,e){r.set(this,e),n.set(this,t.controllerType),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"number",{get:function(){return n.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return r.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=r.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},t}();e.ControlChange=i},804(t,e,r){"use strict";function n(t){var e=[];return i(t,e),e}function i(t,e){for(var r=0;r<t.length;r++){var n=t[r];Array.isArray(n)?i(n,e):e.push(n)}}r.r(e),r.d(e,{flatten:()=>n})},965(t,e,r){e.parseMidi=r(786),e.writeMidi=r(498)},980(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Instrument=void 0;var n=r(659),i=new WeakMap,a=function(){function t(t,e){if(this.number=0,i.set(this,e),this.number=0,t){var r=t.find(function(t){return"programChange"===t.type});r&&(this.number=r.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?n.DrumKitByPatchID[this.number]:n.instrumentByPatchID[this.number]},set:function(t){var e=n.instrumentByPatchID.indexOf(t);-1!==e&&(this.number=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":n.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){return 9===i.get(this).channel},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(t){this.number=t.number},t}();e.Instrument=a},996(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PitchBend=void 0;var r=new WeakMap,n=function(){function t(t,e){r.set(this,e),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"time",{get:function(){return r.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=r.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();e.PitchBend=n}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,r),a.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";class t{static context;constructor(e,r={},n=!1){t.context=this,this.$root=t.make(e,r,n)}static make(e,r={},n=!1){return e&&"object"==typeof r?r instanceof Node?r:("svg"==e&&(n=!0),t.config(n?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e),r,n)):null}static makeIn(e,r,n={},i=!1){return n.context=e,t.make(r,n,i)}static config(e,r,n=!1){if(Array.isArray(e))return e.forEach(e=>t.config(e,r,n)),null;if(!(e instanceof Node)||"object"!=typeof r)return e;let i=r.context;t.context=null===i?null:i||t.context,i=t.context;let a=r=>{if(r)if(r instanceof Node)e.appendChild(r);else if(r instanceof t)e.appendChild(r.$root);else if("string"==typeof r)e.innerHTML+=r;else if("object"==typeof r){let i=t.make(r.tag??"div",r,n||"svg"==r.tag);i&&e.appendChild(i)}};for(const[n,o]of Object.entries(r)){switch(n){case"text":e.textContent=null==o?"":o+"";continue;case"html":e.innerHTML=null==o?"":o+"";continue;case"tag":case"context":case"get":case"also":continue}if(o)switch(n){case"class":(Array.isArray(o)?o:o.split(" ")).map(t=>t&&e.classList.add(t));break;case"push":o.push(e);break;case"$":case"var":i&&(i["$"+o]=e);break;case"events":for(let t in o)e.addEventListener(t,i?o[t].bind(i):o[t]);break;case"click":case"change":case"input":case"mousewheel":e.addEventListener(n,i?o.bind(i):o);break;case"parent":o.appendChild(e);break;case"attrs":for(let t in o)e.setAttribute(t,o[t]);break;case"props":for(let t in o)e[t]=o[t];break;case"child_r":t.clear(e);case"child":a(o);break;case"children_r":t.clear(e);case"children":for(let t of o)a(t);break;case"style_r":e.style.cssText="";case"style":if("string"==typeof o)e.style.cssText+=o+";";else for(let t in o)o[t]&&(e.style[t]=o[t]);break;default:e[n]=o}}return r.also&&i&&r.also.call(i,e),e}static configIn(e,r,n,i=!1){return n.context=e,t.config(r,n,i)}static clear(t){for(;t.firstChild;)t.removeChild(t.lastChild)}static makeArray(e,r=!1){return e&&Array.isArray(e)?e.map(e=>t.make(e.tag,e,r)):[]}static makeShadow(e,r={},n=null){if(!e||"object"!=typeof r)return null;let i=e instanceof Node?e:document.createElement(e);return i.attachShadow({mode:"open"}),t.config(i.shadowRoot,{context:r.context,children:[{tag:"style",textContent:n??""},r.child??{},...r.children??[]]}),delete r.children,delete r.child,t.config(i,r),i}}new Set,new Map;function e(t,e,r="application/octet-stream"){let n;if(t instanceof Blob)n=t;else if(t instanceof Uint8Array)n=new Blob([t],{type:r});else if(t instanceof ArrayBuffer)n=new Blob([new Uint8Array(t)],{type:r});else{if(!ArrayBuffer.isView(t))return void console.error("Download error");n=new Blob([t.buffer],{type:r})}const i=URL.createObjectURL(n),a=document.createElement("a");a.href=i,a.download=e,a.rel="noopener",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i)}class n{_data;constructor(t){this._data=t}get label(){return this._data.$label.innerText}set label(t){return this._data.$label.innerText=t+""}get value(){return this._data.$control.value}set value(t){return this._data.$control.value=t+""}get input(){return this._data.$control}display(t){this._data.$container.style.display=t?"block":"none"}show(){this.display(1)}hide(){this.display(0)}remove(){this._data.$container.remove()}default(){this.value=this._data.default+"",this._data.$output&&(this._data.$output.innerText=this._data.default+"")}}class i extends n{constructor(t){super(t)}set value(t){return this._data.$output&&(this._data.$output.innerText=t+""),this._data.$control.value=t+""}get value(){return Number(this._data.$control.value)}}class a extends i{constructor(t){super(t)}set value(t){return super.value=t}get value(){return this._data.$control.value}set valueInt(t){return"#"+t.toString(16).padStart(6,0)}get valueInt(){return parseInt(this.value.slice(1),16)}}class o extends n{constructor(t){super(t)}get value(){return this._data.$control.checked?1:0}set value(t){return this._data.$control.checked=t}default(){this.value=this._data.default}}class s extends n{constructor(t){super(t)}get value(){return this._data.$control.innerHTML}set value(t){return this._data.$control.innerHTML=t+""}}class c extends n{constructor(t){super(t)}get value(){return this._data.$control.files[0]}set value(t){}}class u extends n{constructor(t){super(t)}set value(t){}get value(){return 1}}class l extends i{constructor(t){super(t)}set options(e){return this._data.$control.replaceChildren(...e.map((e,r)=>t.make("option",{text:e,value:r+""})))}get options(){return Array.from(this._data.$control.options).map(t=>t.text)}get text(){return this.options[this.value]}}class h extends n{constructor(t){super(t)}set value(t){this._data.$control.innerText=t+""}get value(){return this._data.$control.innerText}}class d{constructor(e={}){d.css=function(t){if(t){let e=document.createElement("style");e.innerText=t,document.head.appendChild(e)}return null}(d.css);let r={};return null===(e={...{x:null,y:null,width:"200px",parent:document.body,title:"",zIndex:3,theme:"light",autoVar:!0,class:""},...e}).x&&null===e.y||(r.left=e.x+"px",r.top=e.y+"px",r.position="absolute"),this.autoVar=e.autoVar,this.class=e.class,t.makeIn(this,"div",{style:{zIndex:e.zIndex,width:"string"==typeof e.width?e.width:e.width+"px",...r},parent:e.parent,children:[{class:"ui_title_bar",text:e.title,$:"title"},{class:"ui_content",$:"content"}],$:"root"}),this.setTheme(e.theme)}setTheme(t){return this.$root.classList=`ui_main theme-${t} ${this.class}`,this}destroy(){this.removeAll(),this.$root&&(this.$root.remove(),this.$root=void 0,this.#t=new Map)}setLabels(t){for(let e in t)this.#t.has(e)&&(this.#t.get(e).label=t[e])}toObject(){let t={};return this.#t.forEach((e,r)=>{e instanceof u||(t[r]=e.value)}),t}toJson(){return JSON.stringify(this.toObject())}fromObject(t){for(let e in t)this.#t.has(e)&&(this.#t.get(e).value=t[e])}fromJson(t){this.fromObject(JSON.parse(t))}getWidget(t){return this.#t.get(t)}control(t){return this.#t.get(t)}get(t){return this.#t.has(t)?this.#t.get(t).value:void 0}set(t,e){return this.#t.has(t)&&(this.#t.get(t).value=e),e}remove(t){"string"==typeof t&&(t=[t]);for(let e of t)this.#t.has(e)&&(this.#t.get(e).remove(),this.#t.delete(e),Object.defineProperty(this,e,{get:void 0,set:void 0}),Object.defineProperty(this,e+"Text",{get:void 0}))}removeAll(){this.remove(Array.from(this.#t.keys())),function(t){for(;t.firstChild;)t.removeChild(t.lastChild)}(this.$content)}onChange(t){this.#e=t}addSwitch(e,r,n,i){if(this.#t.has(e))return this;let a={default:n=n?1:0};return t.makeIn(a,"div",{$:"container",class:"ui_container",parent:this.$content,child:{tag:"label",class:"ui_checkbox_cont",children:[{tag:"label",text:r,$:"label"},{tag:"div",class:"ui_checkbox",child:{tag:"label",children:[{tag:"input",type:"checkbox",checked:n,$:"control",change:t=>{let r=t.target.checked?1:0;this.#e(e,r),i&&i(r)}},{tag:"span"}]}}]}}),e&&this.#t.set(e,new o(a)),this._addSetGet(e),this}addNumber(e,r,n,a,o){if(this.#t.has(e))return this;n=n??0;let s=this._makeContainer(r);return s.default=n,t.makeIn(s,"input",{parent:s.$container,type:"number",class:"ui_input",step:(a??1)+"",value:n+"",$:"control",input:t=>{let r=Number(t.target.value);this.#e(e,r),o&&o(r)},mousewheel:()=>{}}),e&&this.#t.set(e,new i(s)),this._addSetGet(e),this}addInput(t,e,r,n){return this.addText(t,e,r,n)}addText(e,r,i,a){if(this.#t.has(e))return this;i=i??"";let o=this._makeContainer(r);return o.default=i,t.makeIn(o,"input",{parent:o.$container,type:"text",class:"ui_input",value:i+"",$:"control",input:t=>{let r=t.target.value;this.#e(e,r),a&&a(r)}}),e&&this.#t.set(e,new n(o)),this._addSetGet(e),this}addRange(...t){return this.addSlider(...t)}addSlider(e,r,n,a,o,s,c){if(this.#t.has(e))return this;n=n??0;let u=this._makeContainerOut(r,n);return u.default=n,t.makeIn(u,"div",{parent:u.$container,class:"ui_range_cont",child:{tag:"input",type:"range",class:"ui_range",min:(a??0)+"",max:(o??100)+"",step:(s??1)+"",value:n+"",$:"control",input:t=>{let r=Number(t.target.value);this.#e(e,r),c&&c(r),u.$output.innerText=r},mousewheel:t=>{t.stopPropagation(),t.preventDefault();let e=t.target;e.value=Number(e.value)+Number(e.step)*(t.deltaY>0?-1:1),e.dispatchEvent(new Event("input"))}}}),e&&this.#t.set(e,new i(u)),this._addSetGet(e),this}addArea(e,r,i,a,o=5){if(this.#t.has(e))return this;i=i??"";let s=this._makeContainer(r);return s.default=i,t.makeIn(s,"textarea",{parent:s.$container,class:"ui_textarea",rows:o,value:i+"",$:"control",input:t=>{let r=t.target.value;this.#e(e,r),a&&a(r)}}),e&&this.#t.set(e,new n(s)),this._addSetGet(e),this}addHTML(e,r,n){if(this.#t.has(e))return this;n=n??"";let i=this._makeContainer(r);return i.default=n,t.makeIn(i,"div",{parent:i.$container,html:n+"",$:"control"}),e&&this.#t.set(e,new s(i)),this._addSetGet(e),this}addElement(t,e,r){if(this.#t.has(t))return this;let n=this._makeContainer(e);return n.default=r,n.$control=r,n.$container.append(r),t&&this.#t.set(t,new s(n)),this._addSetGet(t),this}addSelect(e,r,n,i){if(this.#t.has(e))return this;n=n??[];let a=this._makeContainer(r);return a.default=0,t.makeIn(a,"select",{parent:a.$container,class:"ui_select",$:"control",change:t=>{let r=t.target.selectedIndex,n=t.target.options[r].text;this.#e(e,r,n),i&&i(r,n)},mousewheel:t=>{t.stopPropagation(),t.preventDefault();let e=t.target;if(t.deltaY<0&&e.selectedIndex>0)e.selectedIndex--;else{if(!(t.deltaY>0&&e.selectedIndex<e.options.length-1))return;e.selectedIndex++}e.dispatchEvent(new Event("change"))},children:n.map((e,r)=>t.make("option",{text:e,value:r+""}))}),e&&this.#t.set(e,new l(a)),this._addSetGet(e)&&Object.defineProperty(this,e+"Text",{get:()=>this.getWidget(e).text,configurable:!0}),this}addButton(e,r,n){if(this.#t.has(e))return this;let i={};return t.makeIn(i,"div",{$:"container",class:"ui_button_cont",parent:this.$content,children:[this._makeButton(i,e,r,n)]}),i.$label=i.$control,e&&this.#t.set(e,new u(i)),this}addButtons(e){let r=t.make("div",{class:"ui_button_cont",parent:this.$content});for(let t in e){let n={$container:r},i=e[t];r.append(Array.isArray(i)?this._makeButton(n,t,i[0],i[1]):this._makeButton(n,t,i)),n.$label=n.$control,t&&this.#t.set(t,new u(n))}return this}addFile(e,r,n){if(this.#t.has(e))return this;let i=this._makeContainer(r),a=t=>{let r="";for(let e=0;e<t.length;e++)r+=(e?", ":"")+t[e].name;if(i.$filename.innerText=r.length?r:"...",!t.length)return;let a=1==t.length?t[0]:t;this.#e(e,a),n&&n(a)};return t.makeIn(i,"input",{parent:i.$container,class:"ui_file_chooser",type:"file",$:"control",change:()=>a(i.$control.files),attrs:{multiple:!0}}),t.makeIn(i,"label",{parent:i.$container,class:"ui_file_chooser_label",text:"...",$:"filename",events:{click:()=>i.$control.click(),drop:t=>a(t.dataTransfer.files)}}),e&&this.#t.set(e,new c(i)),["dragenter","dragover","dragleave","drop"].forEach(t=>{this.$root.addEventListener(t,t=>{t.preventDefault(),t.stopPropagation()},!1)}),["dragenter","dragover"].forEach(t=>{this.$root.addEventListener(t,function(){i.$filename.classList.add("active")},!1)}),["dragleave","drop"].forEach(t=>{this.$root.addEventListener(t,function(){i.$filename.classList.remove("active")},!1)}),this._addSetGet(e),this}addColor(e,r,n,i){if(this.#t.has(e))return this;n=n??"#000";let o=this._makeContainerOut(r,n);return o.default=n,t.configIn(o,o.$container,{class:"ui_color_cont",child:{tag:"input",type:"color",class:"ui_color",value:n,$:"control",attrs:{"colorpick-eyedropper-active":!1},input:t=>{let r=t.target.value;this.#e(e,r),i&&i(r),o.$output.innerText=r}}}),e&&this.#t.set(e,new a(o)),this._addSetGet(e),this}addLabel(t,e,r){if(this.#t.has(t))return this;r=r??"";let n=this._makeContainerOut(e,r);return n.$control=n.$output,t&&this.#t.set(t,new h(n)),this._addSetGet(t),this}addSpace(e=5){return t.make("div",{style:`height: ${e}px`,parent:this.$content}),this}_addSetGet(t){return!(!this.autoVar||!t||"function"==typeof this[t])&&(Object.defineProperty(this,t,{get:()=>this.get(t),set:e=>this.set(t,e),configurable:!0}),!0)}_checkID(t){return t||"_empty_"+this.#r++}_makeButton(e,r,n,i){return t.makeIn(e,"button",{class:"ui_button",$:"control",text:n+"",click:t=>{this.#e(r),i&&i()}})}_makeContainer(e){let r={};return t.makeIn(r,"div",{$:"container",class:"ui_container",parent:this.$content,children:[{class:"ui_label",children:[{tag:"b",$:"label",text:e}]}]}),r}_makeContainerOut(e,r){let n={};return t.makeIn(n,"div",{$:"container",class:"ui_container",parent:this.$content,children:[{class:"ui_label",children:[{tag:"b",text:e,$:"label"},{tag:"span",text:": "},{tag:"span",text:r+"",$:"output"}]}]}),n}#t=new Map;#r=0;#e=()=>{};static css='.ui_main.theme-light{--border:#aaa;--back:#fff;--mid:#ccc;--tab:#f0f0f0;--font:#000;--font-mid:#555;--thumb:var(--back)}.ui_main.theme-dark{--border:#484d53;--back:rgb(30, 35, 42);--mid:#22272E;--tab:#2D333B;--font:#ccc;--font-mid:#999;--thumb:var(--font-mid)}.ui_main{background-color:var(--mid);text-align:left;font:12px sans-serif;user-select:none;border:none;border-radius:6px}.ui_main.noback{background:none}.ui_main.noback .ui_container{border:1px solid var(--mid);margin:5px 0}.ui_main.noback .ui_title_bar{display:none}.ui_main.noback .ui_button_cont{margin:5px 0}.ui_main.noback .ui_button{border:1px solid var(--mid)}.ui_content{overflow-y:auto;border-radius:6px}.ui_title_bar{text-align:center;font-weight:700;border:none;background:var(--tab);color:var(--font);font-size:15px;border-radius:5px 5px 0 0}.ui_title_bar:not(:empty){padding:4px}.ui_container{margin:5px;padding:5px;border:none;position:relative;background:var(--tab);color:var(--font);border-radius:5px}.ui_range_cont{display:flex;align-items:center;padding:8px 0 6px 0}.ui_range{appearance:none;box-sizing:border-box;margin:0;padding:0;width:100%;height:2px;background:var(--border);cursor:pointer;touch-action:none}.ui_range::-webkit-slider-thumb{appearance:none;background:var(--thumb);width:16px;height:16px;border-radius:50%;box-shadow:0 0 4px #0000005a}.ui_range::-moz-range-thumb{border:none;background:var(--thumb);width:16px;height:16px;border-radius:50%}.ui_button_cont{margin:5px;gap:5px;display:flex}.ui_button{cursor:pointer;background:var(--tab);color:var(--font-mid);height:26px;border-radius:4px;width:100%;border:none}.ui_button:hover{filter:brightness(.96)}.ui_button:active{background:var(--back)}.ui_checkbox_cont{cursor:pointer;display:flex;align-items:center;justify-content:space-between}.ui_checkbox_cont label{font-weight:700;pointer-events:none}.ui_checkbox{display:inline-block}.ui_checkbox label{display:flex;align-items:center;cursor:pointer;user-select:none}.ui_checkbox input{display:none}.ui_checkbox span{width:18px;height:18px;border:1px solid var(--border);border-radius:4px;background-color:var(--back);position:relative}.ui_checkbox input:checked+span::after{content:"âœ“";position:absolute;left:3px;top:-2px;font-size:16px;color:var(--font);font-weight:700}.ui_label{margin-bottom:3px;user-select:none;-webkit-user-select:none;cursor:default}.ui_input{box-sizing:border-box;width:100%;padding:5px;height:24px;line-height:24px;border:1px solid var(--border);background:var(--back);color:var(--font-mid);border-radius:4px}.ui_select{background:var(--back);color:var(--font-mid);width:100%;height:24px;border:1px solid var(--border);border-radius:0;padding:0 2px;cursor:pointer;border-radius:4px}.ui_textarea{box-sizing:border-box;resize:vertical;width:100%;padding:3px 5px;border:1px solid var(--border);background:var(--back);color:var(--font-mid);border-radius:4px}.ui_textarea::-webkit-scrollbar{width:7px;height:7px}.ui_textarea::-webkit-scrollbar-track{background:none}.ui_textarea::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}.ui_color_cont{display:flex;align-items:center;justify-content:space-between}.ui_color_cont .ui_label{margin:0}.ui_color{cursor:pointer;padding:0;margin:0;border:none;background:none;height:22px;width:22px}.ui_file_chooser{display:none}.ui_file_chooser_label{background:var(--back);color:var(--font-mid);height:24px;border:1px solid var(--border);width:100%;display:block;cursor:pointer;padding:5px;box-sizing:border-box;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border-radius:4px}.ui_file_chooser_label.active{border-width:2px}'}var p=r(748);let f,m=[],b=[],g=0;async function y(t){const e=new FileReader;e.onload=t=>v(new p.Midi(t.target.result)),e.readAsArrayBuffer(t),f.name=function(t,e=16){if(!t)return"_";let r=t.toLowerCase();r=r.replace(/\s+/g,"_"),r=r.replace(/[^a-z0-9_]/g,""),r=r.replace(/_+/g,"_"),r=r.replace(/^_+|_+$/g,""),/^\d/.test(r)&&(r="_"+r);if(r.length>e){const t=r.split("_");let n=t[0];for(let r=1;r<t.length&&!((n+"_"+t[r]).length>e);r++)n+="_"+t[r];r=n.slice(0,e)}return r||"_"}(t.name)}function v(t){m.forEach((t,e)=>{f.remove("track_"+e)}),b=t.header.tempos,b.length||b.push({bpm:120,ticks:0,time:0}),g=t.header.ppq,t.tracks.forEach((e,r)=>{e.channel++,!e.name.length&&r>0?e.name=t.tracks[r-1].name:9!=e.channel&&10!=e.channel||(e.name+=" (drums)")}),m=t.tracks.filter(t=>t.notes.length),m.forEach((t,e)=>{f.addSwitch("track_"+e,`${e}: ${t.name} [${t.notes.length}]`,!0,x)}),x()}function k(){function t(t,e,r,n){for(;n>=0;)t.push({note:e,duration8:S(Math.round(r),3),duration:r,delay:Math.min(Math.round(n),65535)}),n-=65535,r=0}let e=[];const r=m.filter((t,e)=>f["track_"+e]).flatMap(t=>t.notes).sort((t,e)=>t.time-e.time);return r.forEach((n,i)=>{const a=(o=n.ticks,6e4/(b.reduce((t,e)=>e.ticks<=o&&(!t||e.ticks>t.ticks)?e:t,null).bpm*g));var o;!i&&n.ticks&&t(e,0,0,n.ticks*a);const s=r[i+1],c=s?s.ticks-n.ticks:n.durationTicks;t(e,n.midi,n.durationTicks*a,c*a)}),e}function w(){return m.filter((t,e)=>f["track_"+e]).map(t=>t.name).join(" + ")}function x(){const t=k();let e=`#pragma once\n#include <Arduino.h>\n#include "MIDINote.h"\n\n// Library: https://github.com/GyverLibs/GyverMIDI\n// MIDI Converter: https://alexgyver.github.io/MIDI\n\n// ${f.name}: ${w()}\n// ${4*t.length} bytes\nstatic const MIDINote ${f.name}[] PROGMEM = {\n`;t.forEach(t=>e+=`\t{${t.note}, ${t.duration8}, ${t.delay}},\r\n`),e+="};\r\n",f.code=e}function I(){navigator.clipboard.writeText(f.code)}function _(){e((new TextEncoder).encode(f.code),f.name+".h","text/plain")}function T(){const t=k(),r=t.length,n=new ArrayBuffer(4*r),i=new DataView(n);let a=0;t.forEach(t=>{i.setUint8(a,t.note),a+=1,i.setUint8(a,t.duration8),a+=1,i.setUint16(a,t.delay,!0),a+=2}),e(n,f.name+".notes")}function U(){let t=new p.Midi;t.header.setTempo(120);const r=t.addTrack();r.name=w(),r.channel=0;let n=0;k().forEach(t=>{let e=t.duration?t.duration-1:0;r.addNote({midi:t.note,time:n/1e3,duration:e/1e3}),n+=t.delay}),e(t.toArray(),f.name+".mid","audio/midi")}function S(t,e){const r=(1<<e)-1,n=8-e,i=1<<n,a=i-1;if(t<i)return 0;let o=31-Math.clz32(t)-n;return o<0?o=0:o>r&&(o=r),o<<n|t>>o&a}document.addEventListener("DOMContentLoaded",()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js"),f=new d({title:"MIDI Converter",theme:"light",width:300}).addFile("file","File",y).addText("name","Name","midi",x).addArea("code","Code","",null,25).addButtons({copy:["Copy",I],h:[".h",_],bins:["Save bin",T]}).addButton("export","Export midi",U)})})()})();