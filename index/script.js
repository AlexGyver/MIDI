(()=>{var t={412:(t,e)=>{"use strict";function n(t,e,n){void 0===n&&(n="ticks");var r=0,i=t.length,a=i;if(i>0&&t[i-1][n]<=e)return i-1;for(;r<a;){var o=Math.floor(r+(a-r)/2),s=t[o],c=t[o+1];if(s[n]===e){for(var u=o;u<t.length;u++){t[u][n]===e&&(o=u)}return o}if(s[n]<e&&c[n]>e)return o;s[n]>e?a=o:s[n]<e&&(r=o+1)}return-1}Object.defineProperty(e,"__esModule",{value:!0}),e.insert=e.search=void 0,e.search=n,e.insert=function(t,e,r){if(void 0===r&&(r="ticks"),t.length){var i=n(t,e[r],r);t.splice(i+1,0,e)}else t.push(e)}},796:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce((function(t,n){return t[e.controlChangeNames[n]]=n,t}),{});var n=new WeakMap,r=new WeakMap,i=function(){function t(t,e){n.set(this,e),r.set(this,t.controllerType),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"number",{get:function(){return r.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=n.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},t}();e.ControlChange=i},651:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createControlChanges=void 0;var r=n(796);e.createControlChanges=function(){return new Proxy({},{get:function(t,e){return t[e]?t[e]:r.controlChangeIds.hasOwnProperty(e)?t[r.controlChangeIds[e]]:void 0},set:function(t,e,n){return r.controlChangeIds.hasOwnProperty(e)?t[r.controlChangeIds[e]]=n:t[e]=n,!0}})}},547:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,i=0,a=e.length;i<a;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.encode=void 0;var i=n(965),a=n(660),o=n(804);function s(t){return(0,o.flatten)(t.notes.map((function(e){return function(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(127*t.velocity)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(127*t.noteOffVelocity)}]}(e,t.channel)})))}function c(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(127*t.value)}}function u(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}e.encode=function(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:r([r(r(r(r([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map((function(t){return function(t){var e=a.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:"major"===t.scale?0:1,type:"keySignature"}}(t)})),!0),t.header.meta.map((function(t){return{absoluteTime:(e=t).ticks,deltaTime:0,meta:!0,text:e.text,type:e.type};var e})),!0),t.header.tempos.map((function(t){return function(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}(t)})),!0),t.header.timeSignatures.map((function(t){return function(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(t)})),!0)],t.tracks.map((function(t){return r(r(r([(e=t.name,{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}),u(t)],s(t),!0),function(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach((function(n){e.push(c(n,t.channel))}));return e}(t),!0),function(t){var e=[];return t.pitchBends.forEach((function(n){e.push(function(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}(n,t.channel))})),e}(t),!0);var e})),!0)};return e.tracks=e.tracks.map((function(t){t=t.sort((function(t,e){return t.absoluteTime-e.absoluteTime}));var e=0;return t.forEach((function(t){t.deltaTime=t.absoluteTime-e,e=t.absoluteTime,delete t.absoluteTime})),t.push({deltaTime:0,meta:!0,type:"endOfTrack"}),t})),new Uint8Array((0,i.writeMidi)(e))}},660:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var r=n(412),i=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var a=function(){function t(t){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",i.set(this,480),t){i.set(this,t.header.ticksPerBeat),t.tracks.forEach((function(t){t.forEach((function(t){t.meta&&("timeSignature"===t.type?n.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?n.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type&&n.keySignatures.push({key:e.keySignatureKeys[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}))}))}));var r=0;t.tracks[0].forEach((function(t){r+=t.deltaTime,t.meta&&("trackName"===t.type?n.name=t.text:"text"!==t.type&&"cuePoint"!==t.type&&"marker"!==t.type&&"lyrics"!==t.type||n.meta.push({text:t.text,ticks:r,type:t.type}))})),this.update()}}return t.prototype.update=function(){var t=this,e=0,n=0;this.tempos.sort((function(t,e){return t.ticks-e.ticks})),this.tempos.forEach((function(r,i){var a=i>0?t.tempos[i-1].bpm:t.tempos[0].bpm,o=r.ticks/t.ppq-n,s=60/a*o;r.time=s+e,e=r.time,n+=o})),this.timeSignatures.sort((function(t,e){return t.ticks-e.ticks})),this.timeSignatures.forEach((function(e,n){var r=n>0?t.timeSignatures[n-1]:t.timeSignatures[0],i=(e.ticks-r.ticks)/t.ppq/r.timeSignature[0]/(r.timeSignature[1]/4);r.measures=r.measures||0,e.measures=i+r.measures}))},t.prototype.ticksToSeconds=function(t){var e=(0,r.search)(this.tempos,t);if(-1!==e){var n=this.tempos[e],i=n.time,a=(t-n.ticks)/this.ppq;return i+60/n.bpm*a}return.5*(t/this.ppq)},t.prototype.ticksToMeasures=function(t){var e=(0,r.search)(this.timeSignatures,t);if(-1!==e){var n=this.timeSignatures[e],i=(t-n.ticks)/this.ppq;return n.measures+i/(n.timeSignature[0]/n.timeSignature[1])/4}return t/this.ppq/4},Object.defineProperty(t.prototype,"ppq",{get:function(){return i.get(this)},enumerable:!1,configurable:!0}),t.prototype.secondsToTicks=function(t){var e=(0,r.search)(this.tempos,t,"time");if(-1!==e){var n=this.tempos[e],i=(t-n.time)/(60/n.bpm);return Math.round(n.ticks+i*this.ppq)}var a=t/.5;return Math.round(a*this.ppq)},t.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map((function(t){return{bpm:t.bpm,ticks:t.ticks}})),timeSignatures:this.timeSignatures}},t.prototype.fromJSON=function(t){this.name=t.name,this.tempos=t.tempos.map((function(t){return Object.assign({},t)})),this.timeSignatures=t.timeSignatures.map((function(t){return Object.assign({},t)})),this.keySignatures=t.keySignatures.map((function(t){return Object.assign({},t)})),this.meta=t.meta.map((function(t){return Object.assign({},t)})),i.set(this,t.ppq),this.update()},t.prototype.setTempo=function(t){this.tempos=[{bpm:t,ticks:0}],this.update()},t}();e.Header=a},980:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Instrument=void 0;var r=n(659),i=new WeakMap,a=function(){function t(t,e){if(this.number=0,i.set(this,e),this.number=0,t){var n=t.find((function(t){return"programChange"===t.type}));n&&(this.number=n.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?r.DrumKitByPatchID[this.number]:r.instrumentByPatchID[this.number]},set:function(t){var e=r.instrumentByPatchID.indexOf(t);-1!==e&&(this.number=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":r.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){return 9===i.get(this).channel},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(t){this.number=t.number},t}();e.Instrument=a},659:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DrumKitByPatchID=e.InstrumentFamilyByID=e.instrumentByPatchID=void 0,e.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],e.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],e.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},748:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{c(r.next(t))}catch(t){a(t)}}function s(t){try{c(r.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var a=n(965),o=n(660),s=n(710),c=n(547),u=function(){function t(t){var e=this,n=null;if(t){var r=t instanceof ArrayBuffer?new Uint8Array(t):t;(n=(0,a.parseMidi)(r)).tracks.forEach((function(t){var e=0;t.forEach((function(t){e+=t.deltaTime,t.absoluteTime=e}))})),n.tracks=function(t){for(var e=[],n=0;n<t.length;n++)for(var r=e.length,i=new Map,a=Array(16).fill(0),o=0,s=t[n];o<s.length;o++){var c=s[o],u=r,l=c.channel;if(void 0!==l){"programChange"===c.type&&(a[l]=c.programNumber);var h=a[l],d="".concat(h," ").concat(l);i.has(d)?u=i.get(d):(u=r+i.size,i.set(d,u))}e[u]||e.push([]),e[u].push(c)}return e}(n.tracks)}this.header=new o.Header(n),this.tracks=[],t&&(this.tracks=n.tracks.map((function(t){return new s.Track(t,e.header)})),1===n.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return t.fromUrl=function(e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,fetch(e)];case 1:return(n=r.sent()).ok?[4,n.arrayBuffer()]:[3,3];case 2:return[2,new t(r.sent())];case 3:throw new Error("Could not load '".concat(e,"'"))}}))}))},Object.defineProperty(t.prototype,"name",{get:function(){return this.header.name},set:function(t){this.header.name=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var t=this.tracks.map((function(t){return t.duration}));return Math.max.apply(Math,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){var t=this.tracks.map((function(t){return t.durationTicks}));return Math.max.apply(Math,t)},enumerable:!1,configurable:!0}),t.prototype.addTrack=function(){var t=new s.Track(void 0,this.header);return this.tracks.push(t),t},t.prototype.toArray=function(){return(0,c.encode)(this)},t.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map((function(t){return t.toJSON()}))}},t.prototype.fromJSON=function(t){var e=this;this.header=new o.Header,this.header.fromJSON(t.header),this.tracks=t.tracks.map((function(t){var n=new s.Track(void 0,e.header);return n.fromJSON(t),n}))},t.prototype.clone=function(){var e=new t;return e.fromJSON(this.toJSON()),e},t}();e.Midi=u;var l=n(710);Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var h=n(660);Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return h.Header}})},445:(t,e)=>{"use strict";function n(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]}Object.defineProperty(e,"__esModule",{value:!0}),e.Note=void 0;var r,i,a=(r=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,i={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(t){var e=r.exec(t),n=e[1],a=e[2];return i[n.toLowerCase()]+12*(parseInt(a,10)+1)}),o=new WeakMap,s=function(){function t(t,e,n){o.set(this,n),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=e.velocity,this.ticks=t.ticks,this.durationTicks=e.ticks-t.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return t=this.midi,e=Math.floor(t/12)-1,n(t)+e.toString();var t,e},set:function(t){this.midi=a(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var e=t-this.octave;this.midi+=12*e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return n(this.midi)},set:function(t){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var t=o.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var e=o.get(this).secondsToTicks(this.time+t);this.durationTicks=e-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return o.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=o.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){return o.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();e.Note=s},996:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PitchBend=void 0;var n=new WeakMap,r=function(){function t(t,e){n.set(this,e),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(t){var e=n.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();e.PitchBend=r},710:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Track=void 0;var r=n(412),i=n(796),a=n(651),o=n(996),s=n(980),c=n(445),u=new WeakMap,l=function(){function t(t,e){var n=this;if(this.name="",this.notes=[],this.controlChanges=(0,a.createControlChanges)(),this.pitchBends=[],u.set(this,e),t){var r=t.find((function(t){return"trackName"===t.type}));this.name=r?r.text:""}if(this.instrument=new s.Instrument(t,this),this.channel=0,t){for(var i=t.filter((function(t){return"noteOn"===t.type})),o=t.filter((function(t){return"noteOff"===t.type})),c=function(){var t=i.shift();l.channel=t.channel;var e=o.findIndex((function(e){return e.noteNumber===t.noteNumber&&e.absoluteTime>=t.absoluteTime}));if(-1!==e){var n=o.splice(e,1)[0];l.addNote({durationTicks:n.absoluteTime-t.absoluteTime,midi:t.noteNumber,noteOffVelocity:n.velocity/127,ticks:t.absoluteTime,velocity:t.velocity/127})}},l=this;i.length;)c();t.filter((function(t){return"controller"===t.type})).forEach((function(t){n.addCC({number:t.controllerType,ticks:t.absoluteTime,value:t.value/127})})),t.filter((function(t){return"pitchBend"===t.type})).forEach((function(t){n.addPitchBend({ticks:t.absoluteTime,value:t.value/Math.pow(2,13)})}));var h=t.find((function(t){return"endOfTrack"===t.type}));this.endOfTrackTicks=void 0!==h?h.absoluteTime:void 0}}return t.prototype.addNote=function(t){var e=u.get(this),n=new c.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},e);return Object.assign(n,t),(0,r.insert)(this.notes,n,"ticks"),this},t.prototype.addCC=function(t){var e=u.get(this),n=new i.ControlChange({controllerType:t.number},e);return delete t.number,Object.assign(n,t),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),(0,r.insert)(this.controlChanges[n.number],n,"ticks"),this},t.prototype.addPitchBend=function(t){var e=u.get(this),n=new o.PitchBend({},e);return Object.assign(n,t),(0,r.insert)(this.pitchBends,n,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,e=0;e<this.notes.length-1;e++){var n=this.notes[e].time+this.notes[e].duration;t<n&&(t=n)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,e=0;e<this.notes.length-1;e++){var n=this.notes[e].ticks+this.notes[e].durationTicks;t<n&&(t=n)}return t},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(t){var e=this;for(var n in this.name=t.name,this.channel=t.channel,this.instrument=new s.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),void 0!==t.endOfTrackTicks&&(this.endOfTrackTicks=t.endOfTrackTicks),t.controlChanges)t.controlChanges[n]&&t.controlChanges[n].forEach((function(t){e.addCC({number:t.number,ticks:t.ticks,value:t.value})}));t.notes.forEach((function(t){e.addNote({durationTicks:t.durationTicks,midi:t.midi,ticks:t.ticks,velocity:t.velocity})}))},t.prototype.toJSON=function(){for(var t={},e=0;e<127;e++)this.controlChanges.hasOwnProperty(e)&&(t[e]=this.controlChanges[e].map((function(t){return t.toJSON()})));var n={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map((function(t){return t.toJSON()})),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map((function(t){return t.toJSON()}))};return void 0!==this.endOfTrackTicks&&(n.endOfTrackTicks=this.endOfTrackTicks),n},t}();e.Track=l},804:(t,e,n)=>{"use strict";function r(t){var e=[];return i(t,e),e}function i(t,e){for(var n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?i(r,e):e.push(r)}}n.r(e),n.d(e,{flatten:()=>r})},965:(t,e,n)=>{e.parseMidi=n(786),e.writeMidi=n(498)},786:t=>{function e(t){for(var e,r=new n(t),i=[];!r.eof();){var a=o();i.push(a)}return i;function o(){var t={};t.deltaTime=r.readVarInt();var n=r.readUInt8();if(240&~n){var i;if(128&n)i=r.readUInt8(),e=n;else{if(null===e)throw"Running status byte encountered before status byte";i=n,n=e,t.running=!0}var a=n>>4;switch(t.channel=15&n,a){case 8:return t.type="noteOff",t.noteNumber=i,t.velocity=r.readUInt8(),t;case 9:var o=r.readUInt8();return t.type=0===o?"noteOff":"noteOn",t.noteNumber=i,t.velocity=o,0===o&&(t.byte9=!0),t;case 10:return t.type="noteAftertouch",t.noteNumber=i,t.amount=r.readUInt8(),t;case 11:return t.type="controller",t.controllerType=i,t.value=r.readUInt8(),t;case 12:return t.type="programChange",t.programNumber=i,t;case 13:return t.type="channelAftertouch",t.amount=i,t;case 14:return t.type="pitchBend",t.value=i+(r.readUInt8()<<7)-8192,t;default:throw"Unrecognised MIDI event type: "+a}}else{if(255!==n){if(240==n){t.type="sysEx";c=r.readVarInt();return t.data=r.readBytes(c),t}if(247==n){t.type="endSysEx";c=r.readVarInt();return t.data=r.readBytes(c),t}throw"Unrecognised MIDI event type byte: "+n}t.meta=!0;var s=r.readUInt8(),c=r.readVarInt();switch(s){case 0:if(t.type="sequenceNumber",2!==c)throw"Expected length for sequenceNumber event is 2, got "+c;return t.number=r.readUInt16(),t;case 1:return t.type="text",t.text=r.readString(c),t;case 2:return t.type="copyrightNotice",t.text=r.readString(c),t;case 3:return t.type="trackName",t.text=r.readString(c),t;case 4:return t.type="instrumentName",t.text=r.readString(c),t;case 5:return t.type="lyrics",t.text=r.readString(c),t;case 6:return t.type="marker",t.text=r.readString(c),t;case 7:return t.type="cuePoint",t.text=r.readString(c),t;case 32:if(t.type="channelPrefix",1!=c)throw"Expected length for channelPrefix event is 1, got "+c;return t.channel=r.readUInt8(),t;case 33:if(t.type="portPrefix",1!=c)throw"Expected length for portPrefix event is 1, got "+c;return t.port=r.readUInt8(),t;case 47:if(t.type="endOfTrack",0!=c)throw"Expected length for endOfTrack event is 0, got "+c;return t;case 81:if(t.type="setTempo",3!=c)throw"Expected length for setTempo event is 3, got "+c;return t.microsecondsPerBeat=r.readUInt24(),t;case 84:if(t.type="smpteOffset",5!=c)throw"Expected length for smpteOffset event is 5, got "+c;var u=r.readUInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&u],t.hour=31&u,t.min=r.readUInt8(),t.sec=r.readUInt8(),t.frame=r.readUInt8(),t.subFrame=r.readUInt8(),t;case 88:if(t.type="timeSignature",2!=c&&4!=c)throw"Expected length for timeSignature event is 4 or 2, got "+c;return t.numerator=r.readUInt8(),t.denominator=1<<r.readUInt8(),4===c?(t.metronome=r.readUInt8(),t.thirtyseconds=r.readUInt8()):(t.metronome=36,t.thirtyseconds=8),t;case 89:if(t.type="keySignature",2!=c)throw"Expected length for keySignature event is 2, got "+c;return t.key=r.readInt8(),t.scale=r.readUInt8(),t;case 127:return t.type="sequencerSpecific",t.data=r.readBytes(c),t;default:return t.type="unknownMeta",t.data=r.readBytes(c),t.metatypeByte=s,t}}}}function n(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}n.prototype.eof=function(){return this.pos>=this.bufferLen},n.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t},n.prototype.readInt8=function(){var t=this.readUInt8();return 128&t?t-256:t},n.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readInt16=function(){var t=this.readUInt16();return 32768&t?t-65536:t},n.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readInt24=function(){var t=this.readUInt24();return 8388608&t?t-16777216:t},n.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e},n.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)},n.prototype.readVarInt=function(){for(var t=0;!this.eof();){var e=this.readUInt8();if(!(128&e))return t+e;t+=127&e,t<<=7}return t},n.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32();return{id:t,length:e,data:this.readBytes(e)}},t.exports=function(t){var r=new n(t),i=r.readChunk();if("MThd"!=i.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+i.id+"'";for(var a=function(t){var e=new n(t),r=e.readUInt16(),i=e.readUInt16(),a={format:r,numTracks:i},o=e.readUInt16();32768&o?(a.framesPerSecond=256-(o>>8),a.ticksPerFrame=255&o):a.ticksPerBeat=o;return a}(i.data),o=[],s=0;!r.eof()&&s<a.numTracks;s++){var c=r.readChunk();if("MTrk"!=c.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+c.id+"'";var u=e(c.data);o.push(u)}return{header:a,tracks:o}}},498:t=>{function e(t,e,i){var a,o=new r,s=e.length,c=null;for(a=0;a<s;a++)!1!==i.running&&(i.running||e[a].running)||(c=null),c=n(o,e[a],c,i.useByte9ForNoteOff);t.writeChunk("MTrk",o.buffer)}function n(t,e,n,r){var i=e.type,a=e.deltaTime,o=e.text||"",s=e.data||[],c=null;switch(t.writeVarInt(a),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(o.length),t.writeString(o);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(o.length),t.writeString(o);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(o.length),t.writeString(o);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(o.length),t.writeString(o);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(o.length),t.writeString(o);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(o.length),t.writeString(o);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(o.length),t.writeString(o);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var u=31&e.hour|{24:0,25:32,29:64,30:96}[e.frameRate];t.writeUInt8(u),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var l=255&Math.floor(Math.log(e.denominator)/Math.LN2);t.writeUInt8(l),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(s.length),t.writeBytes(s);break;case"unknownMeta":null!=e.metatypeByte&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(s.length),t.writeBytes(s));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(s.length),t.writeBytes(s);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(s.length),t.writeBytes(s);break;case"noteOff":(c=(!1!==r&&e.byte9||r&&0==e.velocity?144:128)|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":(c=144|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":(c=160|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":(c=176|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":(c=192|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.programNumber);break;case"channelAftertouch":(c=208|e.channel)!==n&&t.writeUInt8(c),t.writeUInt8(e.amount);break;case"pitchBend":(c=224|e.channel)!==n&&t.writeUInt8(c);var h=8192+e.value,d=127&h,p=h>>7&127;t.writeUInt8(d),t.writeUInt8(p);break;default:throw"Unrecognized event type: "+i}return c}function r(){this.buffer=[]}r.prototype.writeUInt8=function(t){this.buffer.push(255&t)},r.prototype.writeInt8=r.prototype.writeUInt8,r.prototype.writeUInt16=function(t){var e=t>>8&255,n=255&t;this.writeUInt8(e),this.writeUInt8(n)},r.prototype.writeInt16=r.prototype.writeUInt16,r.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,r=255&t;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r)},r.prototype.writeInt24=r.prototype.writeUInt24,r.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,r=t>>8&255,i=255&t;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(i)},r.prototype.writeInt32=r.prototype.writeUInt32,r.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))},r.prototype.writeString=function(t){var e,n=t.length,r=[];for(e=0;e<n;e++)r.push(t.codePointAt(e));this.writeBytes(r)},r.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];for(n.push(127&e),e>>=7;e;){var r=127&e|128;n.push(r),e>>=7}this.writeBytes(n.reverse())}},r.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)},t.exports=function(t,n){if("object"!=typeof t)throw"Invalid MIDI data";n=n||{};var i,a=t.header||{},o=t.tracks||[],s=o.length,c=new r;for(function(t,e,n){var i=null==e.format?1:e.format,a=128;e.timeDivision?a=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?a=-(255&e.framesPerSecond)<<8|255&e.ticksPerFrame:e.ticksPerBeat&&(a=32767&e.ticksPerBeat);var o=new r;o.writeUInt16(i),o.writeUInt16(n),o.writeUInt16(a),t.writeChunk("MThd",o.buffer)}(c,a,s),i=0;i<s;i++)e(c,o[i],n);return c.buffer}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r].call(a.exports,a,a.exports,n),a.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";class t{constructor(e,n={}){n.context=this,this.$root=t.make(e,n)}static make(e,n={}){return e&&"object"==typeof n?n instanceof Node?n:t.config(document.createElement(e),n):null}static makeShadow(e,n={},r=null){if(!e||"object"!=typeof n)return null;let i=e instanceof Node?e:document.createElement(e);return i.attachShadow({mode:"open"}),t.config(i.shadowRoot,{context:n.context,children:[{tag:"style",textContent:r??""},n.child??{},...n.children??[]]}),delete n.children,delete n.child,t.config(i,n),i}static config(e,n){if(!(e instanceof Node)||"object"!=typeof n)return e;const r=n.context;let i=n=>{if(n)if(n instanceof Node)e.appendChild(n);else if(n instanceof t)e.appendChild(n.$root);else if("object"==typeof n){n.context||(n.context=r);let i=t.make(n.tag,n);i&&e.appendChild(i)}else"string"==typeof n&&(e.innerHTML+=n)};for(const[t,a]of Object.entries(n))if(a)switch(t){case"tag":case"context":continue;case"text":e.textContent=a;break;case"html":e.innerHTML=a;break;case"class":e.classList.add(...a.split(" "));break;case"also":r&&a.call(r,e);break;case"export":a[0]=e;break;case"var":r&&(r["$"+a]=e);break;case"events":for(let t in a)a[t]&&e.addEventListener(t,a[t].bind(r));break;case"parent":(a instanceof Node||a instanceof DocumentFragment)&&a.append(e);break;case"attrs":for(let t in a)e.setAttribute(t,a[t]);break;case"props":for(let t in a)e[t]=a[t];break;case"child":i(a);break;case"children":for(const t of a)i(t);break;case"style":if("string"==typeof a)e.style.cssText+=a+";";else for(let t in a)e.style[t]=a[t];break;default:e[t]=a}return e}static makeArray(e){return e&&Array.isArray(e)?e.map((e=>t.make(e.tag,e))):[]}}new Set,new Map;class e{_data;constructor(t){this._data=t}get label(){return this._data.$label.innerText}set label(t){return this._data.$label.innerText=t+""}get value(){return this._data.$control.value}set value(t){return this._data.$control.value=t+""}get input(){return this._data.$control}display(t){this._data.$container.style.display=t?"block":"none"}show(){this.display(1)}hide(){this.display(0)}remove(){this._data.$container.remove()}default(){this.value=this._data.default+"",this._data.$output&&(this._data.$output.innerText=this._data.default+"")}}class r extends e{constructor(t){super(t)}set value(t){return this._data.$output&&(this._data.$output.innerText=t+""),this._data.$control.value=t+""}get value(){return Number(this._data.$control.value)}}class i extends e{constructor(t){super(t)}get value(){return this._data.$control.checked}set value(t){return this._data.$control.checked=t}default(){this.value=this._data.default}}class a extends e{constructor(t){super(t)}get value(){return this._data.$control.innerHTML}set value(t){return this._data.$control.innerHTML=t+""}}class o extends e{constructor(t){super(t)}get value(){return this._data.$control.files[0]}set value(t){}}class s extends e{constructor(t){super(t)}set value(t){}get value(){return 1}}class c extends r{constructor(t){super(t)}set options(e){return this._data.$control.replaceChildren(...e.map(((e,n)=>t.make("option",{text:e,value:n+""}))))}}class u extends e{constructor(t){super(t)}set value(t){this._data.$control.innerText=t+""}get value(){return this._data.$control.innerText}}class l{constructor(t={}){if(!l._injected){l._injected=!0;let t=document.createElement("style");t.innerText=h,document.head.appendChild(t)}return this.init(t)}init(e){return e&&"object"==typeof e?(this.autoVar=e.autoVar??!0,t.make("div",{class:"ui_main theme-"+(e.theme??"light"),style:{zIndex:e.zIndex??3,left:e.x??0,top:e.y??0,width:e.width?"string"==typeof e.width?e.width:e.width+"px":"200px",position:e.parent?"":"absolute"},parent:e.parent??document.body,children:[{tag:"div",class:"ui_title_bar",text:e.title??"UI"},{tag:"div",class:"ui_content",var:"content"}],var:"root",context:this}),this):this}setTheme(t){return this.$root.classList="ui_main theme-"+t,this}destroy(){this.$root&&(this.$root.remove(),this.$root=void 0,this.#t=new Map)}setLabels(t){for(let e in t)this.#t.has(e)&&(this.#t.get(e).label=t[e])}toObject(){let t={};return this.#t.forEach(((e,n)=>{!e.value||e instanceof s||(t[n]=e.value)})),t}toJson(){return JSON.stringify(this.toObject())}fromObject(t){for(let e in t)this.#t.has(e)&&(this.#t.get(e).value=t[e])}fromJson(t){this.fromObject(JSON.parse(t))}control(t){return this.#t.get(t)}get(t){if(this.#t.has(t))return this.#t.get(t).value}set(t,e){if(this.#t.has(t))return this.#t.get(t).value=e}remove(t){this.#t.has(t)&&(this.#t.get(t).remove(),this.#t.delete(t),Object.defineProperty(this,t,{get:void 0,set:void 0}))}addSwitch(e,n,r,a){let o={default:r=r??!1};return t.make("div",{context:o,var:"container",class:"ui_container",parent:this.$content,children:[{tag:"label",class:"ui_checkbox_label",text:n,var:"label"},{tag:"label",class:"ui_checkbox",children:[{tag:"input",type:"checkbox",checked:r,var:"control",also(t){a&&t.addEventListener("click",(()=>a(t.checked)))}},{tag:"span"}]}]}),e&&this.#t.set(e,new i(o)),this._addSetGet(e),this}addNumber(e,n,i,a,o){i=i??0;let s=this._makeContainer(n);return s.default=i,t.make("input",{parent:s.$container,context:s,type:"number",class:"ui_text_input ui_number",step:(a??1)+"",value:i+"",var:"control",also(t){t.addEventListener("input",(()=>{o&&o(Number(t.value))})),t.addEventListener("mousewheel",(t=>{}))}}),e&&this.#t.set(e,new r(s)),this._addSetGet(e),this}addText(n,r,i,a){i=i??"";let o=this._makeContainer(r);return o.default=i,t.make("input",{parent:o.$container,context:o,type:"text",class:"ui_text_input",value:i+"",var:"control",also(t){a&&t.addEventListener("input",(()=>a(t.value)))}}),n&&this.#t.set(n,new e(o)),this._addSetGet(n),this}addRange(e,n,i,a,o,s,c){i=i??0;let u=this._makeContainerOut(n,i);return u.default=i,t.make("input",{parent:u.$container,context:u,type:"range",class:"ui_range",value:i+"",min:(a??0)+"",max:(o??100)+"",step:(s??1)+"",var:"control",also(t){t.addEventListener("input",(()=>{c&&c(Number(t.value)),u.$output.innerText=t.value})),t.addEventListener("mousewheel",(e=>{e.stopPropagation(),e.preventDefault(),t.value=Number(t.value)+Number(t.step)*(e.deltaY>0?-1:1),t.dispatchEvent(new Event("input"))}))}}),e&&this.#t.set(e,new r(u)),this._addSetGet(e),this}addArea(n,r,i,a,o=5){i=i??"";let s=this._makeContainer(r);return s.default=i,t.make("textarea",{parent:s.$container,context:s,class:"ui_textarea",rows:o,value:i+"",var:"control",also(t){a&&t.addEventListener("input",(()=>a(t.value)))}}),n&&this.#t.set(n,new e(s)),this._addSetGet(n),this}addHTML(e,n,r){r=r??"";let i=this._makeContainer(n);return i.default=r,t.make("div",{parent:i.$container,context:i,html:r+"",var:"control"}),e&&this.#t.set(e,new a(i)),this._addSetGet(e),this}addElement(t,e,n){let r=this._makeContainer(e);return r.default=n,r.$control=n,r.$container.append(n),t&&this.#t.set(t,new a(r)),this._addSetGet(t),this}addSelect(e,n,r,i){r=r??[];let a=this._makeContainer(n);return a.default=0,t.make("select",{parent:a.$container,context:a,class:"ui_select",var:"control",also(t){i&&t.addEventListener("change",(()=>i(Number(t.value))))},children:r.map(((e,n)=>t.make("option",{text:e,value:n+""})))}),e&&this.#t.set(e,new c(a)),this._addSetGet(e),this}addButton(e,n,r){let i={};return t.make("div",{context:i,var:"container",class:"ui_container",parent:this.$content,children:[this._makeButton(i,e,n,r)]}),i.$label=i.$control,e&&this.#t.set(e,new s(i)),this}addButtons(e){let n=t.make("div",{var:"container",class:"ui_container",parent:this.$content});for(let t in e){let r={$container:n};n.append(this._makeButton(r,t,e[t][0],e[t][1])),r.$label=r.$control,t&&this.#t.set(t,new s(r))}return this}addFile(e,n,r){let i=this._makeContainer(n),a=t=>{r&&r(1==t.length?t[0]:t),i.$filename.innerText=t[0].name};return i.$container.append(...t.makeArray([{tag:"input",context:i,class:"ui_file_chooser",type:"file",var:"control",attrs:{multiple:!0},also(t){t.addEventListener("change",(()=>a(t.files)))}},{tag:"label",context:i,class:"ui_file_chooser_label",text:"...",var:"filename",also(t){t.addEventListener("click",(()=>i.$control.click())),t.addEventListener("drop",(t=>a(t.dataTransfer.files)))}}])),e&&this.#t.set(e,new o(i)),["dragenter","dragover","dragleave","drop"].forEach((t=>{this.$root.addEventListener(t,(t=>{t.preventDefault(),t.stopPropagation()}),!1)})),["dragenter","dragover"].forEach((t=>{this.$root.addEventListener(t,(function(){i.$filename.classList.add("active")}),!1)})),["dragleave","drop"].forEach((t=>{this.$root.addEventListener(t,(function(){i.$filename.classList.remove("active")}),!1)})),this._addSetGet(e),this}addColor(e,n,i,a){i=i??"#000";let o=this._makeContainerOut(n,i);return o.default=i,o.$container.append(t.make("input",{context:o,type:"color",class:"ui_color",value:i,var:"control",attrs:{"colorpick-eyedropper-active":!1},also(t){t.addEventListener("input",(()=>{a&&a(t.value),o.$output.innerText=t.value}))}})),e&&this.#t.set(e,new r(o)),this._addSetGet(e),this}addLabel(t,e,n){n=n??"";let r=this._makeContainerOut(e,n);return r.$control=r.$output,t&&this.#t.set(t,new u(r)),this._addSetGet(t),this}addSpace(){return t.make("div",{class:"ui_space",parent:this.$content}),this}_addSetGet(t){this.autoVar&&t&&Object.defineProperty(this,t,{get:()=>this.get(t),set:e=>this.set(t,e),configurable:!0})}_checkID(t){return t||"_empty_"+this.#e++}_makeButton(e,n,r,i){return t.make("button",{context:e,class:"ui_button",var:"control",text:r+"",also(t){i&&t.addEventListener("click",(()=>i(1)))}})}_makeContainer(e){let n={};return t.make("div",{context:n,var:"container",class:"ui_container",parent:this.$content,children:[{tag:"div",class:"ui_label",children:[{tag:"b",var:"label",text:e}]}]}),n}_makeContainerOut(e,n){let r={};return t.make("div",{context:r,var:"container",class:"ui_container",parent:this.$content,children:[{tag:"div",class:"ui_label",children:[{tag:"b",text:e,var:"label"},{tag:"span",text:": "},{tag:"span",text:n+"",var:"output"}]}]}),r}#t=new Map;#e=0;static _injected=!1}const h="\n.ui_main.theme-light {\n    --border: #aaa;\n    --back: #fff;\n    --mid: #ccc;\n    --bright: #eee;\n    --font: #000;\n    --font-mid: #555;\n}\n\n.ui_main.theme-dark {\n    --border: #444c56;\n    --back: rgb(30, 35, 42);\n    --mid: #22272E;\n    --bright: #2D333B;\n    --font: #ccc;\n    --font-mid: #999;\n}\n\n.ui_main {\n    background-color: var(--mid);\n    text-align: left;\n    font: 12px sans-serif;\n    box-shadow: 5px 5px 8px rgba(0, 0, 0, 0.35);\n    user-select: none;\n    -webkit-user-select: none;\n    border: none\n}\n\n.ui_content {\n    background: var(--mid);\n    overflow-y: auto\n}\n\n.ui_title_bar {\n    user-select: none;\n    -webkit-user-select: none;\n    padding: 5px;\n    font-weight: bold;\n    border: none;\n    background: var(--bright);\n    color: var(--font);\n}\n\n.ui_container {\n    margin: 5px;\n    padding: 5px;\n    border: none;\n    position: relative;\n    background: var(--bright);\n    color: var(--font);\n}\n\n.ui_space {\n    height: 1px;\n}\n\n.ui_range {\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    width: 100%;\n    height: 17px;\n    padding: 0;\n    margin: 0;\n    background-color: transparent;\n    border: none;\n    -webkit-box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box\n}\n\n.ui_range:focus {\n    outline: none;\n    border: none\n}\n\n.ui_range::-webkit-slider-runnable-track {\n    width: 100%;\n    height: 15px;\n    cursor: pointer;\n    background: var(--back);\n    -webkit-border-radius: 0;\n    -moz-border-radius: 0;\n    border-radius: 0\n}\n\n.ui_range:focus::-webkit-slider-runnable-track {\n    background: var(--back);\n}\n\n.ui_range::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    height: 15px;\n    width: 15px;\n    -webkit-border-radius: 0;\n    -moz-border-radius: 0;\n    border-radius: 0;\n    background: var(--border);\n    cursor: pointer;\n    margin-top: 0\n}\n\n.ui_range::-moz-range-track {\n    width: 100%;\n    height: 15px;\n    cursor: pointer;\n    background: var(--back);\n    -webkit-border-radius: 0;\n    -moz-border-radius: 0;\n    border-radius: 0\n}\n\n.ui_range::-moz-range-thumb {\n    height: 15px;\n    width: 15px;\n    border: none;\n    -webkit-border-radius: 0;\n    -moz-border-radius: 0;\n    border-radius: 0;\n    background: var(--border);\n    cursor: pointer\n}\n\n.ui_button {\n    cursor: pointer;\n    background: var(--mid);\n    color: var(--font-mid);\n    height: 26px;\n    border: 1px solid var(--border);\n    font: 12px sans-serif;\n    margin: 2px;\n}\n\n.ui_button:active {\n    background: var(--back);\n}\n\n.ui_checkbox {\n    cursor: pointer;\n    display: inline\n}\n\n.ui_checkbox input {\n    position: absolute;\n    left: -99999px\n}\n\n.ui_checkbox span {\n    height: 16px;\n    width: 100%;\n    display: block;\n    text-indent: 20px;\n    background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAALklEQVQ4T2OcOXPmfwYKACPIgLS0NLKMmDVrFsOoAaNhMJoOGBioFwZkZUWoJgApdFaxjUM1YwAAAABJRU5ErkJggg==') no-repeat\n}\n\n.ui_checkbox input:checked+span {\n    background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAvElEQVQ4T63Tyw2EIBAA0OFKBxBL40wDRovAUACcKc1IB1zZDAkG18GYZTmSmafzgTnnMgwchoDWGlJKheGcP3JtnPceCqCUAmttSZznuYtgchsXQrgC+77DNE0kUpPbmBOoJaBOIVQylnqWgAAeKhDve/AN+EaklJBzhhgjWRoJVGTbNjiOowAIret6a+4jYIwpX8aDwLIs74C2D0IIYIyVP6Gm898m9kbVm85ljHUTf16k4VUefkwDrxk+zoUEwCt0GbUAAAAASUVORK5CYII=') no-repeat\n}\n\n.ui_checkbox_label {\n    position: absolute;\n    top: 7px;\n    left: 30px;\n    pointer-events: none;\n}\n\n.ui_label {\n    margin-bottom: 3px;\n    user-select: none;\n    -webkit-user-select: none;\n    cursor: default;\n    font: 12px sans-serif\n}\n\n.ui_text_input {\n    -webkit-box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n    width: 100%;\n    padding: 0 0 0 5px;\n    height: 24px;\n    font-size: 12px;\n    border: 1px inset var(--border);\n    background: var(--back);\n    color: var(--font-mid);\n    outline: none;\n}\n\n.ui_select {\n    background: var(--back);\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    appearance: none;\n    color: var(--font-mid);\n    width: 100%;\n    height: 24px;\n    border: 1px solid var(--border);\n    -webkit-border-radius: 0;\n    -moz-border-radius: 0;\n    border-radius: 0;\n    padding: 0 5px;\n    -moz-outline: none;\n    font-size: 14px;\n    cursor: pointer;\n}\n\n.ui_select option {\n    font-size: 14px\n}\n\n.ui_select:focus {\n    outline: none\n}\n\n.ui_number {\n    height: 24px\n}\n\n.ui_textarea {\n    -webkit-box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n    resize: vertical;\n    width: 100%;\n    padding: 3px 5px;\n    font-size: 12px;\n    border: 1px inset var(--border);\n    background: var(--back);\n    color: var(--font-mid);\n    outline: none;\n}\n\n.ui_textarea::-webkit-scrollbar {\n    width: 7px;\n    height: 7px;\n}\n\n.ui_textarea::-webkit-scrollbar-track {\n    background: none;\n}\n\n.ui_textarea::-webkit-scrollbar-thumb {\n    background: var(--border);\n    border-radius: 3px;\n}\n\n.ui_color {\n    padding: 0;\n    margin: 0;\n    outline: none;\n    cursor: pointer;\n    background: none;\n    border: none;\n    height: 30px;\n    width: 100%;\n}\n\n.ui_file_chooser {\n    position: absolute;\n    left: -999999px\n}\n\n.ui_file_chooser_label {\n    background: var(--back);\n    color: var(--font);\n    height: 30px;\n    border: 1px solid var(--border);\n    font: 12px sans-serif;\n    width: 100%;\n    display: block;\n    cursor: pointer;\n    padding: 7px;\n    -webkit-box-sizing: border-box;\n    -moz-box-sizing: border-box;\n    box-sizing: border-box;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis\n}\n\n.ui_file_chooser_label.active {\n    border: 2px solid var(--font);\n}\n";var d=n(748);let p,f=[];async function m(t){const e=new FileReader;e.onload=t=>g(new d.Midi(t.target.result)),e.readAsArrayBuffer(t)}async function b(t){try{g(await d.Midi.fromUrl(t))}catch(t){}}function g(t){f.forEach(((t,e)=>{p.remove("channel_"+e)}));let e=6e4/(Math.round(t.header.tempos[0].bpm)*t.header.ppq);f=[];let n=0;t.tracks.forEach((t=>{if(t.notes.length){let r=[];t.notes.forEach(((n,i)=>{!i&&n.ticks&&r.push({us:0,duration:0,delay:Math.round(n.ticks*e)});let a=Math.round(n.durationTicks*e),o=Math.round((t.notes[i+1]?t.notes[i+1].ticks-n.ticks:n.durationTicks)*e),s=440*Math.pow(2,(n.midi-69)/12);s=Math.round(1e6/s),9!=t.channel&&10!=t.channel||(s=n.midi),r.push({us:s,duration:a,delay:o})}));let i=t.name.length?t.name:"Unnamed "+n++;9!=t.channel&&10!=t.channel||(i+=" [drums]"),f.push({name:i,notes:r})}})),f.forEach(((t,e)=>{p.addSwitch("channel_"+e,`${t.name} [${t.notes.length}]`,!0,v)})),v()}function v(){let t='#pragma once\n#include "GyverMIDI.h"\n\n// MIDI Converter: https://alexgyver.github.io/MIDI\n';f.forEach(((e,n)=>{p["channel_"+n]&&(t+=`\n// ${e.name}\nstatic const GyverMIDI::Note ${p.name}_${n}[] PROGMEM = {\n`,e.notes.forEach((e=>{t+=`\t{${e.us}, ${e.duration}, ${e.delay}},\r\n`})),t+="};\r\n")})),p.code=t}function k(){navigator.clipboard.writeText(p.code)}function y(){let t=(new TextEncoder).encode(p.code),e=new Blob([t],{type:"text/plain"}),n=document.createElement("a");n.href=window.URL.createObjectURL(e),n.download="midi.h",n.click()}function w(){f.forEach(((t,e)=>{if(!p["channel_"+e])return;let n=[];n.push(t.notes.length),t.notes.forEach((t=>n.push(t.us,t.duration,t.delay)));let r=Uint16Array.from(n),i=new Blob([r],{type:"application/octet-stream"}),a=document.createElement("a");a.href=window.URL.createObjectURL(i),a.download=t.name+".notes",a.click()}))}document.addEventListener("DOMContentLoaded",(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js"),p=new l({title:"MIDI Converter",theme:"light",width:300}).addFile("file","File",m).addText("link","Link","",b).addText("name","Name","midi",v).addArea("code","Code","",null,15).addButtons({copy:["Copy",k],h:[".h",y],bins:["bins",w]})}))})()})();